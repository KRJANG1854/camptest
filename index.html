<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
<title>모바일 지도로 요일 라벨러</title>
<style>
  :root{
    --bg:#0b0b0f; --panel:#14151a; --muted:#7f8596; --text:#e9ecf1; --accent:#5aa2ff; --danger:#ff6b6b;
    --btn:#1c1f27; --btn2:#202431; --border:#2a3040;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,sans-serif;}
  .app{display:flex;flex-direction:column;gap:10px;max-width:1000px;margin:0 auto;padding:10px;}
  .toolbar{display:grid;grid-template-columns:1fr;gap:10px;}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px;}
  .row{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .btn{appearance:none;border:1px solid var(--border);background:var(--btn);color:var(--text);padding:10px 12px;border-radius:12px;font-size:14px;font-weight:600;cursor:pointer}
  .seg{display:inline-flex;background:var(--btn2);border:1px solid var(--border);border-radius:12px;overflow:hidden}
  .seg button{all:unset;padding:10px 12px;cursor:pointer;color:var(--text);font-weight:700}
  .seg button[aria-pressed="true"]{background:var(--accent);color:#000}
  .map-wrap{position:relative;background:#0a0b0f;border:1px solid var(--border);border-radius:14px;overflow:hidden;touch-action:none;height:68vh}
  .map-stage{position:relative;transform-origin:0 0}
  .map-img{display:block;max-width:none;height:auto;pointer-events:none;user-select:none}
  .labels{position:absolute;left:0;top:0;right:0;bottom:0}
  .label{position:absolute;transform:translate(-50%,-100%);padding:.35em .5em;border-radius:10px;
    border:1px solid rgba(255,255,255,.15);background:rgba(17,20,28,.85);color:#fff;font-weight:800;
    white-space:nowrap;box-shadow:0 4px 10px rgba(0,0,0,.35)}
  .label.normal{background:rgba(30,143,255,.9)}
  .label.extended{background:rgba(255,166,0,.95)}
  .label[data-size="25"]{font-size:10px}
  .label[data-size="50"]{font-size:12px}
  .label[data-size="70"]{font-size:14px}
  .label[data-size="100"]{font-size:16px}
  .version{position:fixed;right:10px;top:8px;padding:6px 10px;background:rgba(90,162,255,.15);
    border:1px solid var(--border);border-radius:10px;font-weight:700;font-size:13px}
</style>
</head>
<body>
<div class="version">V2.4</div>

<div class="app">
  <div class="toolbar">
    <div class="panel">
      <div class="row">
        <label class="btn" for="mapFile">지도 업로드/교체</label>
        <input id="mapFile" type="file" accept="image/*" />
        <button class="btn" id="resetView">보기 리셋</button>
      </div>
    </div>
  </div>

  <div id="mapWrap" class="map-wrap">
    <div id="stage" class="map-stage">
      <img id="mapImg" class="map-img" alt="지도 이미지" />
      <div id="labels" class="labels"></div>
    </div>
  </div>
</div>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const mapFile=$('#mapFile'), mapImg=$('#mapImg'), mapWrap=$('#mapWrap'), stage=$('#stage'), labels=$('#labels');
  const LS_KEY='map_v24';
  let state={mapDataUrl:'',labels:[],view:{scale:1,tx:0,ty:0}};

  function save(){localStorage.setItem(LS_KEY,JSON.stringify(state));}
  function load(){try{const d=JSON.parse(localStorage.getItem(LS_KEY));if(d)state=d;}catch{}}

  function fitCover(){
    const w=mapImg.naturalWidth,h=mapImg.naturalHeight;
    const r=mapWrap.getBoundingClientRect();
    const s=Math.max(r.width/w,r.height/h);
    state.view.scale=s;
    state.view.tx=(r.width-w*s)/2;
    state.view.ty=(r.height-h*s)/2;
    apply();
  }
  function apply(){stage.style.transform=`translate(${state.view.tx}px,${state.view.ty}px) scale(${state.view.scale})`;save();}

  async function setMap(file){
    const data=await new Promise((res,rej)=>{
      const fr=new FileReader();
      fr.onload=()=>res(fr.result);
      fr.onerror=rej;
      fr.readAsDataURL(file);
    });
    state.mapDataUrl=data;
    mapImg.src=data;
    mapImg.onload=()=>{fitCover();};
    save();
  }

  mapFile.addEventListener('change',e=>{
    const f=e.target.files?.[0];
    if(f) setMap(f);
  });

  function addLabelAt(x,y){
    const r=stage.getBoundingClientRect();
    const xPct=((x-r.left)/r.width)*100;
    const yPct=((y-r.top)/r.height)*100;
    const el=document.createElement('div');
    el.className='label normal';
    el.textContent='월';
    el.style.left=xPct+'%';
    el.style.top=yPct+'%';
    labels.appendChild(el);
    state.labels.push({xPct,yPct,text:'월',kind:'normal',size:100});
    save();
  }

  mapWrap.addEventListener('click',e=>{
    if(!mapImg.src)return;
    addLabelAt(e.clientX,e.clientY);
  });

  load();
  if(state.mapDataUrl){
    mapImg.src=state.mapDataUrl;
    mapImg.onload=()=>{fitCover();state.labels.forEach(l=>{
      const el=document.createElement('div');
      el.className='label normal';
      el.textContent=l.text;
      el.style.left=l.xPct+'%';
      el.style.top=l.yPct+'%';
      labels.appendChild(el);
    });};
  }
})();
</script>
</body>
</html>
